<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBS for Parkinson's AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrolling on the parent page */
        }
        #chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 700px;
            margin: auto;
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            scrollbar-width: thin;
            scrollbar-color: #a8a29e #f5f5f4;
        }
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f5f5f4;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: #a8a29e;
            border-radius: 10px;
            border: 3px solid #f5f5f4;
        }
        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
        }
        .message .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        .message .avatar.user-avatar {
            background-color: #3b82f6;
        }
        .message .avatar.bot-avatar {
            background-color: #16a34a;
        }
        .message .avatar-icon {
            color: white;
            width: 24px;
            height: 24px;
        }
        .message .text-content {
            background-color: #ffffff;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            max-width: 80%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .user .text-content {
            background-color: #eff6ff;
        }
        .bot .text-content {
             background-color: #f0fdf4;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            margin: 0 2px;
            background-color: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="chat-container">
        <header class="bg-blue-600 text-white p-4 text-center shadow-md">
            <h1 class="text-xl font-bold">AI Assistant for DBS & Parkinson's</h1>
            <p class="text-sm">Ask me anything about Deep Brain Stimulation</p>
        </header>

        <div id="chat-messages">
            <!-- Bot welcome message -->
            <div class="message bot">
                 <div class="avatar bot-avatar">
                    <svg class="avatar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM15.75 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                 </div>
                <div class="text-content">
                    <p>Hello! I'm an AI assistant designed to provide information about Deep Brain Stimulation for Parkinson's Disease. How can I help you today?</p>
                    <p class="text-xs text-gray-500 mt-2"><strong>Disclaimer:</strong> I am not a medical professional. Please consult a qualified doctor for medical advice.</p>
                </div>
            </div>
        </div>

        <footer class="p-4 bg-white border-t border-gray-200">
            <div class="flex">
                <input type="text" id="user-input" class="w-full px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ask a question..." autocomplete="off">
                <button id="send-btn" class="bg-blue-600 text-white px-6 py-2 rounded-r-lg hover:bg-blue-700 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" /></svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        const API_KEY = ""; // This will be handled by the environment, leave it empty.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

        const systemPrompt = `You are a specialist AI assistant for a leading neurosurgery clinic in India. Your sole purpose is to answer questions about Deep Brain Stimulation (DBS) specifically for Parkinson's Disease.
        - **Persona**: You are knowledgeable, empathetic, patient, and reassuring. Use clear, simple language and avoid overly technical jargon.
        - **Core Knowledge**: You must be able to explain what DBS is, who is a good candidate, the benefits, the risks, what the surgery and recovery process involves, and how the device works post-surgery.
        - **CRITICAL RULE**: You are NOT a doctor. You MUST NOT provide medical advice, diagnoses, or treatment plans. Every single response must begin with the disclaimer: "**Disclaimer: This information is for educational purposes only. It is not a substitute for professional medical advice. Please consult with a qualified neurologist or neurosurgeon for personalized guidance.**"
        - **Conversation Flow**: Keep answers focused and concise. After answering, you can gently prompt the user with a follow-up question like "Does that make sense?" or "Is there anything else about that you'd like to know?".
        - **Out of Scope**: If the user asks about anything other than DBS for Parkinson's (e.g., other conditions, other treatments, clinic prices, appointments), you must politely decline and steer the conversation back. Say something like, "I can only provide information about Deep Brain Stimulation for Parkinson's Disease. Do you have any questions about that topic?"`;

        async function callGeminiAPI(userQuery) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I'm having trouble connecting right now. Please try again later.";
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "An error occurred while contacting the AI assistant. Please check your browser console for details.";
            }
        }

        function addMessage(sender, text) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            
            const avatarClass = sender === 'user' ? 'user-avatar' : 'bot-avatar';
            const avatarIcon = sender === 'user' 
                ? `<svg class="avatar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>`
                : `<svg class="avatar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM15.75 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;

            messageElement.innerHTML = `
                <div class="avatar ${avatarClass}">${avatarIcon}</div>
                <div class="text-content">${text.replace(/\n/g, '<br>')}</div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.id = 'typing-indicator';
            typingElement.classList.add('message', 'bot');
            typingElement.innerHTML = `
                <div class="avatar bot-avatar">
                    <svg class="avatar-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM15.75 21v-1.5m0 0a3 3 0 100-6 3 3 0 000 6zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <div class="text-content typing-indicator">
                    <span></span><span></span><span></span>
                </div>
            `;
            chatMessages.appendChild(typingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typing-indicator');
            if (typingElement) {
                typingElement.remove();
            }
        }

        async function handleUserInput() {
            const query = userInput.value.trim();
            if (!query) return;

            addMessage('user', query);
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            showTypingIndicator();

            const responseText = await callGeminiAPI(query);
            
            removeTypingIndicator();
            addMessage('bot', responseText);
            
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }

        sendBtn.addEventListener('click', handleUserInput);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                handleUserInput();
            }
        });
    </script>
</body>
</html>
